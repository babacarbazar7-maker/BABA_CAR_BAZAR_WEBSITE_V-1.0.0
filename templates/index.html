<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Baba Car Bazar | Pro Edition</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;700;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        :root {
            --primary: #2400f2; /* Cyan Neon */
            --secondary: #ff0050; /* Pink Neon */
            --glass-bg: rgba(18, 18, 28, 0.65);
            --glass-border: rgba(255, 255, 255, 0.08);
            --bg-color: #050505;
            --text-color: #e0e0e0;
        }

        /* LIGHT MODE OVERRIDES */
        [data-bs-theme="light"] {
            --primary: #007bff;
            --secondary: #dc3545;
            --glass-bg: rgba(255, 255, 255, 0.95);
            --glass-border: rgba(0, 0, 0, 0.1);
            --bg-color: #f4f6f8;
            --text-color: #212529;
        }
        
        body {
            font-family: 'Outfit', sans-serif;
            background: var(--bg-color);
            color: var(--text-color);
            overflow-x: hidden;
            min-height: 100vh;
            scroll-behavior: smooth;
            transition: background 0.3s, color 0.3s;
        }

        /* --- BACKGROUND ANIMATION --- */
        .nebula-bg {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; z-index: -1;
            background: 
                radial-gradient(circle at 15% 50%, rgba(76, 201, 240, 0.15), transparent 25%),
                radial-gradient(circle at 85% 30%, rgba(247, 37, 133, 0.15), transparent 25%);
            animation: pulseNebula 10s ease-in-out infinite alternate;
        }
        [data-bs-theme="light"] .nebula-bg { display: none; }

        .stars {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
            background-image: radial-gradient(white, rgba(255,255,255,.2) 1px, transparent 1.5px);
            background-size: 400px 400px;
            animation: moveStars 120s linear infinite;
        }
        [data-bs-theme="light"] .stars { display: none; }

        @keyframes pulseNebula { 0% { opacity: 0.5; } 100% { opacity: 1; } }
        @keyframes moveStars { from { transform: translateY(0); } to { transform: translateY(-500px); } }

        /* --- UI COMPONENTS --- */
        .glass-panel {
            background: var(--glass-bg);
            backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        [data-bs-theme="light"] .glass-panel { box-shadow: 0 4px 12px rgba(0,0,0,0.05); }

        .glass-panel:hover {
            box-shadow: 0 8px 32px 0 rgba(0, 242, 234, 0.1); 
            border-color: rgba(255,255,255,0.2);
        }

        .navbar {
            background: rgba(5, 5, 10, 0.9);
            backdrop-filter: blur(15px);
            border-bottom: 1px solid var(--glass-border);
        }
        [data-bs-theme="light"] .navbar { background: rgba(255, 255, 255, 0.95); border-bottom: 1px solid #ddd; }

        /* --- DROPDOWN MENU CUSTOMIZATION --- */
        .dropdown-menu {
            background: rgba(18, 18, 28, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
            margin-top: 15px !important;
        }
        [data-bs-theme="light"] .dropdown-menu {
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid rgba(0,0,0,0.1);
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }
        .dropdown-item { color: #e0e0e0; padding: 10px 20px; transition: 0.2s; }
        [data-bs-theme="light"] .dropdown-item { color: #333; }
        .dropdown-item:hover { background: rgba(255,255,255,0.1); color: var(--primary); }
        [data-bs-theme="light"] .dropdown-item:hover { background: rgba(0,0,0,0.05); }
        .dropdown-divider { border-top: 1px solid rgba(255,255,255,0.1); }
        [data-bs-theme="light"] .dropdown-divider { border-top: 1px solid rgba(0,0,0,0.1); }

        .dropdown-toggle::after { display: none; }

        /* --- CAR VIEW PAGE (Detail) --- */
        .detail-grid {
            display: grid;
            grid-template-columns: 1fr 0.8fr;
            gap: 30px;
            margin-top: 30px;
        }
        .detail-img-box img {
            width: 100%;
            height: 500px; /* FIXED HEIGHT FOR DETAIL IMAGES */
            object-fit: cover;
            border-radius: 20px;
            border: 1px solid var(--glass-border);
            box-shadow: 0 20px 40px rgba(0,0,0,0.5);
        }
        .detail-info-box {
            padding: 40px;
            display: flex; flex-direction: column; justify-content: center;
        }
        .price-tag {
            font-size: 3.5rem; font-weight: 700;
            background: linear-gradient(to right, var(--text-color), #aaa);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
        [data-bs-theme="light"] .price-tag { background: linear-gradient(to right, #007bff, #0056b3); -webkit-background-clip: text; }

        .spec-item {
            display: flex; justify-content: space-between;
            padding: 12px 0; border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        [data-bs-theme="light"] .spec-item { border-bottom: 1px solid rgba(0,0,0,0.1); }
        
        .wishlist-btn {
            position: absolute; top: 15px; right: 15px; z-index: 10;
            background: rgba(0,0,0,0.5); border: 1px solid rgba(255,255,255,0.2);
            color: white; border-radius: 50%; width: 40px; height: 40px;
            display: flex; align-items: center; justify-content: center;
            transition: 0.3s;
        }
        .wishlist-btn:hover { background: var(--secondary); border-color: var(--secondary); }

        /* --- WHATSAPP STICKY BUTTON --- */
        .whatsapp-sticky {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 1000;
            background: #25d366;
            color: white;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 35px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
            transition: transform 0.3s;
            text-decoration: none;
        }
        .whatsapp-sticky:hover {
            transform: scale(1.1);
            color: white;
            box-shadow: 0 0 20px rgba(37, 211, 102, 0.6);
        }

        /* --- BRAND MARQUEE STYLE --- */
        .marquee-container {
            width: 100%;
            overflow: hidden;
            background: rgba(0,0,0,0.8);
            border-bottom: 1px solid var(--glass-border);
            padding: 12px 0;
            margin-top: 76px; /* Offset for fixed navbar */
        }
        .marquee-track {
            display: flex;
            width: fit-content;
            gap: 4rem;
            animation: marqueeScroll 25s linear infinite;
        }
        .brand-logo {
            font-size: 1.5rem;
            color: #888;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
            white-space: nowrap;
            text-transform: uppercase;
        }
        .brand-logo i { color: var(--primary); }
        @keyframes marqueeScroll {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }

        /* --- BANNER & PROMO STYLES --- */
        .hero-banner-img {
            width: 100%;
            height: 80vh;
            object-fit: cover;
            filter: brightness(0.9);
        }
        .promo-badge {
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(10px);
            border: 1px solid var(--primary);
            box-shadow: 0 0 20px rgba(0, 242, 234, 0.2);
            padding: 15px 30px;
            border-radius: 90px;
            display: inline-block;
            margin-top: 20px;
            animation: pulseGlow 2s infinite;
        }
        @keyframes pulseGlow {
            0% { box-shadow: 0 0 10px rgba(0, 242, 234, 0.2); }
            50% { box-shadow: 0 0 25px rgba(0, 242, 234, 0.6); }
            100% { box-shadow: 0 0 10px rgba(0, 242, 234, 0.2); }
        }

        /* --- MAILBOX & ADMIN STYLES --- */
        .mail-list { list-style: none; padding: 0; margin: 0; }
        .mail-item {
            display: grid;
            grid-template-columns: 40px 1fr 1fr 100px; 
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            cursor: pointer;
            transition: background 0.2s;
        }
        .mail-item:hover { background: rgba(255,255,255,0.03); }
        .mail-item.unread { font-weight: 700; color: white; border-left: 3px solid var(--primary); background: rgba(0, 242, 234, 0.05); }
        [data-bs-theme="light"] .mail-item.unread { color: #000; background: rgba(0,123,255,0.1); }
        .mail-item.read { color: #888; }
        
        .admin-sidebar {
            min-height: 90vh;
            border-right: 1px solid var(--glass-border);
            padding-top: 20px;
            transition: all 0.3s;
        }
        .nav-link-admin {
            color: #bbb; padding: 12px 20px; display: block; border-radius: 10px; margin-bottom: 5px; text-decoration: none;
            transition: 0.3s;
        }
        .nav-link-admin:hover, .nav-link-admin.active {
            background: linear-gradient(90deg, rgba(0, 242, 234, 0.1), transparent);
            color: var(--primary);
            border-left: 3px solid var(--primary);
        }

        /* --- FOOTER STYLES --- */
        footer {
            background: #000; color: #888; padding: 60px 0 20px; margin-top: 80px; border-top: 1px solid #222;
        }
        [data-bs-theme="light"] footer { background: #f8f9fa; color: #555; border-top: 1px solid #ddd; }
        footer h5 { color: #fff; font-weight: 700; margin-bottom: 20px; }
        [data-bs-theme="light"] footer h5 { color: #000; }
        footer a { color: #888; text-decoration: none; display: block; margin-bottom: 10px; transition: 0.3s; }
        footer a:hover { color: var(--primary); padding-left: 5px; }

        /* --- RESPONSIVE --- */
        @media (max-width: 991px) {
            .navbar-collapse {
                background: rgba(5,5,5,0.95);
                padding: 20px;
                border-radius: 10px;
                border: 1px solid var(--glass-border);
                margin-top: 10px;
            }
            [data-bs-theme="light"] .navbar-collapse { background: #fff; }
            .detail-grid { grid-template-columns: 1fr; } 
            .detail-info-box { padding: 25px; }
            .price-tag { font-size: 2.5rem; }
            .hero-banner-img { height: 40vh; }
            .admin-sidebar { 
                min-height: auto; height: auto; border-right: none; border-bottom: 1px solid var(--glass-border); padding: 15px; margin-bottom: 20px;
                display: flex; flex-direction: row; overflow-x: auto; white-space: nowrap;
            }
            .admin-sidebar .nav { flex-direction: row; gap: 10px; }
            .nav-link-admin { display: inline-block; margin: 0; padding: 8px 15px; border-left: none; border-bottom: 3px solid transparent; }
            .nav-link-admin:hover, .nav-link-admin.active { border-left: none; border-bottom: 3px solid var(--primary); background: rgba(0, 242, 234, 0.05); }
            .avatar-section { display: none; }
            .mail-item { grid-template-columns: 30px 1fr; gap: 5px; }
            .mail-item div:nth-child(3) { grid-column: 1 / -1; margin-left: 30px; }
            .mail-item div:nth-child(4) { display: none; }
        }
    </style>
</head>
<body>

    <div class="nebula-bg"></div>
    <div class="stars"></div>

    <nav class="navbar navbar-expand-lg fixed-top">
        <div class="container">
            <a class="navbar-brand fst-italic" href="/" style="font-family: 'Outfit', sans-serif; font-weight: 900; font-size: 1.8rem; color: var(--text-color); letter-spacing: -1px; text-shadow: 0 0 15px rgba(0, 242, 234, 0.3);">
                BABA <span style="color: var(--primary);">CAR BAZAR</span>
            </a>
            
            <div class="d-flex align-items-center gap-3 order-lg-3">
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navContent">
                    <span class="fa fa-bars" style="color: var(--text-color);"></span>
                </button>
            </div>

            <div class="collapse navbar-collapse" id="navContent">
                <div class="ms-auto d-flex flex-column flex-lg-row align-items-lg-center gap-4">
                    <a href="/" class="small text-uppercase fw-bold" style="color: var(--text-color); text-decoration:none;">Home</a>
                    <a href="/inventory" class="small text-uppercase fw-bold" style="color: var(--text-color); text-decoration:none;">Inventory</a>
                    <a href="/about" class="small text-uppercase fw-bold" style="color: var(--text-color); text-decoration:none;">About Us</a>
                    
                    {% if current_user.is_authenticated %}
                        <div class="dropdown text-center">
                            <a href="#" class="d-block text-decoration-none dropdown-toggle" id="profileDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                <div class="d-flex flex-column align-items-center">
                                    <div class="bg-gradient-primary rounded-circle d-flex align-items-center justify-content-center text-dark fw-bold shadow-sm" 
                                         style="width: 45px; height: 45px; font-size: 1.3rem; border: 2px solid rgba(255,255,255,0.5); background: var(--primary);">
                                        {{ current_user.name[0] | upper }}
                                    </div>
                                    <span class="small fw-bold mt-1" style="color: var(--text-color); font-size: 0.75rem; letter-spacing: 0.5px;">{{ current_user.name }}</span>
                                </div>
                            </a>
                            <ul class="dropdown-menu dropdown-menu-end mt-2" aria-labelledby="profileDropdown">
                                <li><a class="dropdown-item" href="/profile"><i class="fas fa-user-circle me-2"></i> My Profile</a></li>
                                <li><a class="dropdown-item text-warning" href="/sell-car"><i class="fas fa-car me-2"></i> Sell Car</a></li>
                                {% if current_user.is_admin %}
                                <li><a class="dropdown-item text-info" href="/admin"><i class="fas fa-chart-line me-2"></i> Admin Panel</a></li>
                                {% endif %}
                                <li><hr class="dropdown-divider"></li>
                                <li>
                                    <button class="dropdown-item" onclick="toggleTheme()">
                                        <i class="fas fa-adjust me-2"></i> Theme: Light/Dark
                                    </button>
                                </li>
                                <li><a class="dropdown-item text-danger" href="/logout"><i class="fas fa-sign-out-alt me-2"></i> Log Out</a></li>
                            </ul>
                        </div>
                    {% else %}
                        <a href="/login" class="btn btn-sm btn-primary rounded-pill px-4 fw-bold text-dark">Login</a>
                        <button class="btn btn-sm btn-outline-secondary rounded-circle ms-2" onclick="toggleTheme()" title="Toggle Theme"><i class="fas fa-moon"></i></button>
                    {% endif %}
                </div>
            </div>
        </div>
    </nav>

    <div class="marquee-container">
        <div class="marquee-track">
            <div class="brand-logo"><i class="fab fa-swift"></i> MARUTI SUZUKI</div>
            <div class="brand-logo"><i class="fas fa-car"></i> HYUNDAI</div>
            <div class="brand-logo"><i class="fas fa-gem"></i> TATA MOTORS</div>
            <div class="brand-logo"><i class="fas fa-truck-pickup"></i> MAHINDRA</div>
            <div class="brand-logo"><i class="fab fa-toyota"></i> TOYOTA</div>
            <div class="brand-logo"><i class="fab fa-honda"></i> HONDA</div>
            <div class="brand-logo"><i class="fab fa-css3"></i> KIA</div>
            <div class="brand-logo"><i class="fab fa-wolf-pack-battalion"></i> VOLKSWAGEN</div>
            <div class="brand-logo"><i class="fab fa-staylinked"></i> SKODA</div>
            <div class="brand-logo"><i class="fab fa-bandcamp"></i> BMW</div>
            <div class="brand-logo"><i class="fab fa-medium-m"></i> MERCEDES</div>
            <div class="brand-logo"><i class="fab fa-swift"></i> MARUTI SUZUKI</div>
            <div class="brand-logo"><i class="fas fa-car"></i> HYUNDAI</div>
            <div class="brand-logo"><i class="fas fa-gem"></i> TATA MOTORS</div>
            <div class="brand-logo"><i class="fas fa-truck-pickup"></i> MAHINDRA</div>
        </div>
    </div>

    <a href="https://wa.me/8299638480" target="_blank" class="whatsapp-sticky">
        <i class="fab fa-whatsapp"></i>
    </a>

    <div class="container-fluid pt-3" style="min-height: 80vh;">
        
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                <div class="alert alert-{{ category }} glass-panel text-center text-white border-0 mt-3 container w-50 mx-auto fade show alert-dismissible">
                    {{ message }} <button class="btn-close btn-close-white" data-bs-dismiss="alert"></button>
                </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        {% if page == 'home' %}
            
            <div id="heroCarousel" class="carousel slide mb-5" data-bs-ride="carousel" data-aos="fade-down">
                <div class="carousel-inner" style="border-radius: 30px; overflow: hidden;">
                    {% if banners %}
                        {% for banner in banners %}
                        <div class="carousel-item {{ 'active' if loop.first else '' }}">
                            <img src="{{ url_for('static', filename='uploads/' + banner.image) }}" class="d-block w-100 hero-banner-img" alt="Banner">
                            <div class="carousel-caption d-block">
                                <div class="glass-panel p-4 d-inline-block rounded-4">
                                    <h1 class="fw-bold text-white mb-2" style="text-shadow: 2px 2px 4px #000;">{{ banner.title }}</h1>
                                    <p class="lead text-light mb-0">{{ banner.subtitle }}</p>
                                    
                                    {% if latest_promo %}
                                    <div class="promo-badge">
                                        <div class="small text-uppercase text-info mb-1">üî• Exclusive Offer</div>
                                        <span class="h4 fw-bold text-white">Code: {{ latest_promo.code }}</span>
                                        <div class="small text-white-50">Save ‚Çπ{{ latest_promo.discount_amount }} Instantly!</div>
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    {% else %}
                        <div class="carousel-item active">
                            <img src="https://images.unsplash.com/photo-1560179707-f14e90ef3623?auto=format&fit=crop&w=1200&q=80" class="d-block w-100 hero-banner-img">
                            <div class="carousel-caption d-block">
                                <h3 class="fw-bold text-white glass-panel p-3 rounded-pill d-inline-block">Welcome to Baba Car Bazar</h3>
                            </div>
                        </div>
                    {% endif %}
                </div>
                {% if banners|length > 1 %}
                <button class="carousel-control-prev" type="button" data-bs-target="#heroCarousel" data-bs-slide="prev"><span class="carousel-control-prev-icon"></span></button>
                <button class="carousel-control-next" type="button" data-bs-target="#heroCarousel" data-bs-slide="next"><span class="carousel-control-next-icon"></span></button>
                {% endif %}
            </div>

            <div class="container pt-2">
                <div class="text-center mb-5" data-aos="zoom-in">
                    <h1 class="display-3 fw-bold" style="letter-spacing: -2px;">FUTURE OF <span style="color: var(--primary);">DRIVING</span></h1>
                    <p class="text-secondary">Premium Certified Vehicles ‚Ä¢ Unmatched Quality</p>
                    <div class="mt-4">
                        <a href="/inventory" class="btn btn-primary rounded-pill px-5 fw-bold py-3 text-dark">Browse Inventory</a>
                        <a href="/sell-car" class="btn btn-outline-light rounded-pill px-5 fw-bold py-3 ms-2">Sell Your Car</a>
                    </div>
                </div>
                
                <h3 class="mb-4 fw-bold border-start border-4 border-info ps-3" style="color: var(--text-color);">Featured Arrivals</h3>
                <div class="row g-4 mb-5">
                    {% for car in cars %}
                    <div class="col-md-6 col-lg-4" data-aos="fade-up" data-aos-delay="{{ loop.index * 50 }}">
                        <div class="glass-panel h-100 position-relative overflow-hidden">
                            {% if current_user.is_authenticated %}
                            <a href="/wishlist/toggle/{{ car.id }}" class="wishlist-btn"><i class="fas fa-heart"></i></a>
                            {% endif %}
                            <span class="badge bg-white text-dark fw-bold position-absolute top-0 start-0 m-3 rounded-pill px-3">{{ car.status }}</span>
                            <div style="height: 250px; overflow: hidden;">
                                <img src="{{ url_for('static', filename='uploads/' + car.img_list[0]) }}" class="w-100 h-100" style="object-fit: cover; transition: transform 0.5s;">
                            </div>
                            <div class="p-4">
                                <h4 class="fw-bold mb-1">{{ car.name }}</h4>
                                <div class="d-flex justify-content-between align-items-end mt-3">
                                    <div>
                                        <div class="small text-secondary text-uppercase">{{ car.year }} ‚Ä¢ {{ car.fuel }}</div>
                                        <div class="fs-4 fw-bold text-info">‚Çπ{{ "{:,}".format(car.price) }}</div>
                                    </div>
                                    <a href="/car/{{ car.id }}" class="btn btn-outline-light rounded-circle" style="width: 40px; height: 40px;"><i class="fas fa-arrow-right"></i></a>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>

                <div class="row mb-5">
                    <div class="col-12 text-center mb-4">
                        <h2 class="fw-bold" style="color: var(--text-color);">Browse by Category</h2>
                    </div>
                    <div class="col-md-6 mb-3">
                        <div class="glass-panel p-4 h-100">
                            <h4 class="text-warning mb-3">üî• Top SUVs</h4>
                            {% for car in suvs %}
                            <div class="d-flex align-items-center gap-3 border-bottom border-secondary py-2">
                                <img src="{{ url_for('static', filename='uploads/' + car.img_list[0]) }}" width="60" height="40" class="rounded" style="object-fit:cover;">
                                <div><strong style="color: var(--text-color);">{{ car.name }}</strong><br><small class="text-info">‚Çπ{{ "{:,}".format(car.price) }}</small></div>
                                <a href="/car/{{ car.id }}" class="ms-auto btn btn-sm btn-outline-secondary">View</a>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <div class="glass-panel p-4 h-100">
                            <h4 class="text-success mb-3">üèéÔ∏è Premium Sedans</h4>
                            {% for car in sedans %}
                            <div class="d-flex align-items-center gap-3 border-bottom border-secondary py-2">
                                <img src="{{ url_for('static', filename='uploads/' + car.img_list[0]) }}" width="60" height="40" class="rounded" style="object-fit:cover;">
                                <div><strong style="color: var(--text-color);">{{ car.name }}</strong><br><small class="text-info">‚Çπ{{ "{:,}".format(car.price) }}</small></div>
                                <a href="/car/{{ car.id }}" class="ms-auto btn btn-sm btn-outline-secondary">View</a>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>

        {% elif page == 'inventory' %}
            <div class="container pt-4">
                <div class="row">
                    <div class="col-lg-3 mb-4">
                        <div class="glass-panel p-4 sticky-top" style="top: 100px; z-index: 1;">
                            <h5 class="fw-bold mb-3"><i class="fas fa-filter me-2"></i> Filter</h5>
                            <form action="/inventory" method="GET">
                                <div class="mb-3">
                                    <label class="small text-secondary">Brand</label>
                                    <select name="brand" class="form-select bg-dark text-white border-secondary">
                                        <option value="">All Brands</option>
                                        {% for b in brands %}
                                        <option value="{{ b }}" {% if request.args.get('brand') == b %}selected{% endif %}>{{ b }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label class="small text-secondary">Fuel Type</label>
                                    <select name="fuel" class="form-select bg-dark text-white border-secondary">
                                        <option value="">Any</option>
                                        <option value="Petrol" {% if request.args.get('fuel') == 'Petrol' %}selected{% endif %}>Petrol</option>
                                        <option value="Diesel" {% if request.args.get('fuel') == 'Diesel' %}selected{% endif %}>Diesel</option>
                                        <option value="CNG" {% if request.args.get('fuel') == 'CNG' %}selected{% endif %}>CNG</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label class="small text-secondary">Max Price: ‚Çπ<span id="priceVal">100</span>L</label>
                                    <input type="range" name="max_price" class="form-range" min="50000" max="10000000" step="50000" value="{{ request.args.get('max_price', 10000000) }}" oninput="document.getElementById('priceVal').innerText = (this.value/100000).toFixed(1)">
                                </div>
                                <button class="btn btn-primary w-100 fw-bold">Apply Filters</button>
                                <a href="/inventory" class="btn btn-outline-light btn-sm w-100 mt-2">Clear</a>
                            </form>
                        </div>
                    </div>
                    <div class="col-lg-9">
                        <div class="row g-4">
                            {% for car in cars %}
                            <div class="col-md-6 col-lg-4" data-aos="fade-up">
                                <div class="glass-panel h-100 position-relative overflow-hidden">
                                    {% if current_user.is_authenticated %}
                                    <a href="/wishlist/toggle/{{ car.id }}" class="wishlist-btn"><i class="fas fa-heart"></i></a>
                                    {% endif %}
                                    <span class="badge bg-white text-dark fw-bold position-absolute top-0 start-0 m-3 rounded-pill px-3">{{ car.status }}</span>
                                    <div style="height: 200px; overflow: hidden;">
                                        <img src="{{ url_for('static', filename='uploads/' + car.img_list[0]) }}" class="w-100 h-100" style="object-fit: cover;">
                                    </div>
                                    <div class="p-3">
                                        <h5 class="fw-bold mb-1">{{ car.name }}</h5>
                                        <div class="text-warning small mb-2">
                                            {% if car.avg_rating > 0 %}
                                                {% for i in range(car.avg_rating|int) %}<i class="fas fa-star"></i>{% endfor %} ({{ car.avg_rating|round(1) }})
                                            {% else %}
                                                <span class="text-muted">No ratings</span>
                                            {% endif %}
                                        </div>
                                        <div class="d-flex justify-content-between align-items-end mt-2">
                                            <div>
                                                <div class="small text-secondary">{{ car.year }} ‚Ä¢ {{ car.km_driven }}km</div>
                                                <div class="fs-5 fw-bold text-info">‚Çπ{{ "{:,}".format(car.price) }}</div>
                                            </div>
                                            <a href="/car/{{ car.id }}" class="btn btn-sm btn-outline-light rounded-circle"><i class="fas fa-arrow-right"></i></a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>

        {% elif page == 'profile' %}
            <div class="container pt-4">
                <h2 class="fw-bold mb-4" style="color: var(--text-color);">My Dashboard</h2>
                <div class="row justify-content-center">
                    <div class="col-md-10 mb-4">
                        <div class="glass-panel p-4 h-100">
                            <h4 class="mb-3 text-danger"><i class="fas fa-heart me-2"></i> Wishlist</h4>
                            {% if not wishlist %}<p class="text-muted">No saved cars yet.</p>{% endif %}
                            <div class="d-flex flex-column gap-3">
                                {% for car in wishlist %}
                                <div class="d-flex align-items-center bg-dark p-2 rounded">
                                    <img src="{{ url_for('static', filename='uploads/' + car.img_list[0]) }}" width="60" height="40" class="rounded me-3" style="object-fit:cover;">
                                    <div class="flex-grow-1">
                                        <div class="fw-bold text-white">{{ car.name }}</div>
                                        <div class="small text-info">‚Çπ{{ "{:,}".format(car.price) }}</div>
                                    </div>
                                    <a href="/car/{{ car.id }}" class="btn btn-sm btn-outline-light"><i class="fas fa-eye"></i></a>
                                    <a href="/wishlist/toggle/{{ car.id }}" class="btn btn-sm btn-outline-danger ms-1"><i class="fas fa-times"></i></a>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        {% elif page == 'sell' %}
            <div class="container pt-5">
                <div class="row justify-content-center">
                    <div class="col-md-8 col-lg-6">
                        <div class="glass-panel p-5" data-aos="fade-up">
                            <h2 class="fw-bold text-center mb-4">Value Your Car</h2>
                            <p class="text-center text-secondary mb-4">Use our AI-powered tool to get an instant price estimate.</p>
                            <div class="mb-3"><label>Model Year</label><input type="number" id="sellYear" class="form-control bg-dark text-white border-secondary"></div>
                            <div class="mb-4"><label>Kilometers Driven</label><input type="number" id="sellKm" class="form-control bg-dark text-white border-secondary"></div>
                            <button onclick="predictPrice()" class="btn btn-warning w-100 fw-bold py-3 text-dark mb-4">Get Valuation</button>
                            <div id="priceResult" class="text-center d-none">
                                <p class="small text-secondary text-uppercase mb-1">Estimated Market Value</p>
                                <h1 class="display-4 fw-bold text-success" id="predictedValue">‚Çπ0</h1>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <script>
                async function predictPrice() {
                    const year = document.getElementById('sellYear').value;
                    const km = document.getElementById('sellKm').value;
                    if(!year || !km) { alert("Please fill details"); return; }
                    const res = await fetch('/api/predict_price', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({year: year, km: km}) });
                    const data = await res.json();
                    document.getElementById('predictedValue').innerText = "‚Çπ" + data.price.toLocaleString();
                    document.getElementById('priceResult').classList.remove('d-none');
                }
            </script>

        {% elif page == 'detail' %}
            <div class="container pt-3 pb-5">
                <a href="javascript:history.back()" class="text-secondary text-decoration-none mb-3 d-block"><i class="fas fa-arrow-left me-2"></i> Back</a>
                <div class="detail-grid">
                    <div class="detail-img-box" data-aos="fade-right">
                        <div id="carGallery" class="carousel slide" data-bs-ride="carousel">
                            <div class="carousel-inner">
                                {% for img in car.img_list %}
                                <div class="carousel-item {{ 'active' if loop.first else '' }}">
                                    <img src="{{ url_for('static', filename='uploads/' + img) }}" class="d-block w-100" style="height: 500px; object-fit: cover;">
                                </div>
                                {% endfor %}
                            </div>
                            <button class="carousel-control-prev" data-bs-target="#carGallery" data-bs-slide="prev"><span class="carousel-control-prev-icon"></span></button>
                            <button class="carousel-control-next" data-bs-target="#carGallery" data-bs-slide="next"><span class="carousel-control-next-icon"></span></button>
                        </div>
                        <div class="glass-panel p-4 mt-4">
                            <h4 class="mb-3">Reviews <span class="text-warning"><i class="fas fa-star"></i> {{ avg_rating }}</span></h4>
                            {% if current_user.is_authenticated %}
                            <form action="/add-review" method="POST" class="mb-4">
                                <input type="hidden" name="car_id" value="{{ car.id }}">
                                <div class="input-group">
                                    <select name="rating" class="form-select bg-dark text-white border-secondary" style="max-width:80px;">
                                        <option value="5">5‚òÖ</option><option value="4">4‚òÖ</option><option value="3">3‚òÖ</option>
                                    </select>
                                    <input type="text" name="comment" class="form-control bg-dark text-white border-secondary" placeholder="Write a review..." required>
                                    <button class="btn btn-primary">Post</button>
                                </div>
                            </form>
                            {% endif %}
                            <div style="max-height: 200px; overflow-y: auto;">
                                {% for r in reviews %}
                                <div class="mb-2 border-bottom border-secondary pb-2">
                                    <div class="d-flex justify-content-between">
                                        <strong>{{ r.user.name }}</strong>
                                        <span class="text-warning small">{% for i in range(r.rating) %}‚òÖ{% endfor %}</span>
                                    </div>
                                    <p class="small text-secondary m-0">{{ r.comment }}</p>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                    <div class="glass-panel detail-info-box" data-aos="fade-left">
                        <div class="d-flex justify-content-between">
                            <h5 class="text-primary text-uppercase letter-spacing-2">{{ car.brand }}</h5>
                            {% if current_user.is_authenticated %}
                                <a href="/wishlist/toggle/{{ car.id }}" class="btn btn-outline-danger btn-sm rounded-circle"><i class="fas fa-heart"></i></a>
                            {% endif %}
                        </div>
                        <h1 class="display-5 fw-bold mb-2">{{ car.name }}</h1>
                        <div class="price-tag mb-4" id="finalPrice">‚Çπ{{ "{:,}".format(car.price) }}</div>
                        <div class="input-group mb-3">
                            <input type="text" id="promoCode" class="form-control bg-dark text-white border-secondary" placeholder="Enter Promo Code">
                            <button class="btn btn-outline-warning" onclick="checkPromo()">Apply</button>
                        </div>
                        <p id="promoMsg" class="small"></p>
                        <div class="bg-dark p-3 rounded mb-4 border border-secondary">
                            <h6 class="text-white"><i class="fas fa-calculator text-warning me-2"></i> EMI Estimator</h6>
                            <div class="row g-2 align-items-center">
                                <div class="col-6"><small class="text-muted">Down Payment</small><input type="number" id="emiDown" class="form-control form-control-sm bg-black text-white border-0" value="100000" oninput="calcEMI()"></div>
                                <div class="col-6"><small class="text-muted">Tenure (Months)</small><input type="number" id="emiMonths" class="form-control form-control-sm bg-black text-white border-0" value="60" oninput="calcEMI()"></div>
                                <div class="col-12 text-center mt-2"><span class="text-info fw-bold" id="emiResult">‚Çπ0 / month</span></div>
                            </div>
                        </div>
                        <div class="specs mb-4">
                            <div class="spec-item"><span>Model Year</span> <span class="fw-bold">{{ car.year }}</span></div>
                            <div class="spec-item"><span>Kilometers</span> <span class="fw-bold">{{ "{:,}".format(car.km_driven) }} km</span></div>
                            <div class="spec-item"><span>Fuel Type</span> <span class="fw-bold">{{ car.fuel }}</span></div>
                            <div class="spec-item"><span>Transmission</span> <span class="fw-bold">{{ car.transmission }}</span></div>
                            <div class="spec-item"><span>Status</span> <span class="text-success fw-bold">{{ car.status }}</span></div>
                        </div>
                        <div class="d-grid gap-2">
                            <button class="btn btn-primary fw-bold py-3 rounded-pill text-dark" data-bs-toggle="modal" data-bs-target="#enquiryModal">Enquire Now</button>
                        </div>
                    </div>
                </div>
            </div>
            <script>
                function calcEMI() {
                    let P = {{ car.price }} - document.getElementById('emiDown').value;
                    let r = 9.5 / 12 / 100;
                    let n = document.getElementById('emiMonths').value;
                    let emi = (P * r * Math.pow(1 + r, n)) / (Math.pow(1 + r, n) - 1);
                    document.getElementById('emiResult').innerText = "‚Çπ" + Math.round(emi).toLocaleString() + " / month";
                }
                calcEMI();
                async function checkPromo() {
                    let code = document.getElementById('promoCode').value;
                    let msg = document.getElementById('promoMsg');
                    let priceDisplay = document.getElementById('finalPrice');
                    let originalPrice = {{ car.price }};
                    const res = await fetch('/apply-promo', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({code: code}) });
                    const data = await res.json();
                    if(data.valid) {
                        msg.innerHTML = `<span class="text-success">Code Applied! ‚Çπ${data.discount} OFF</span>`;
                        let newPrice = originalPrice - data.discount;
                        priceDisplay.innerText = "‚Çπ" + newPrice.toLocaleString();
                    } else {
                        msg.innerHTML = `<span class="text-danger">Invalid Code</span>`;
                        priceDisplay.innerText = "‚Çπ" + originalPrice.toLocaleString();
                    }
                }
            </script>

        {% elif page == 'admin' %}
            <div class="container-fluid">
                <div class="row">
                    <div class="col-lg-2 glass-panel admin-sidebar m-lg-3">
                        <div class="text-center mb-lg-5 mt-lg-3 avatar-section">
                            <div class="avatar bg-gradient-primary rounded-circle mx-auto mb-2" style="width: 60px; height: 60px; background: #333;"></div>
                            <h6 class="text-white">Admin Control</h6>
                        </div>
                        <nav class="nav flex-lg-column">
                            <a href="#" class="nav-link-admin active" onclick="showTab('dashboard')"><i class="fas fa-chart-pie me-2"></i> Dashboard</a>
                            <a href="#" class="nav-link-admin" onclick="showTab('inbox')"><i class="fas fa-envelope me-2"></i> Inbox</a>
                            <a href="#" class="nav-link-admin" onclick="showTab('banners')"><i class="fas fa-images me-2"></i> Banners</a>
                            <a href="#" class="nav-link-admin" onclick="showTab('promos')"><i class="fas fa-tags me-2"></i> Promo Codes</a>
                            <a href="#" class="nav-link-admin" onclick="showTab('inventory')"><i class="fas fa-car me-2"></i> Inventory</a>
                            <a href="/" class="nav-link-admin mt-lg-5 text-secondary"><i class="fas fa-sign-out-alt me-2"></i> Exit</a>
                        </nav>
                    </div>
                    <div class="col-lg-9 py-4">
                        <div id="dashboard" class="admin-tab">
                            <h2 class="fw-bold mb-4" style="color: var(--text-color);">Analytics</h2>
                            <div class="row g-4 mb-4">
                                <div class="col-6 col-md-3"><div class="glass-panel p-4"><h3 class="fw-bold">{{ stats.total }}</h3><p class="text-secondary m-0">Cars</p></div></div>
                                <div class="col-6 col-md-3"><div class="glass-panel p-4"><h3 class="fw-bold text-info">‚Çπ{{ "{:,.1f}".format(stats.value/100000) }}L</h3><p class="text-secondary m-0">Value</p></div></div>
                                <div class="col-6 col-md-3"><div class="glass-panel p-4"><h3 class="fw-bold text-warning">{{ stats.unread }}</h3><p class="text-secondary m-0">Msgs</p></div></div>
                                <div class="col-6 col-md-3"><div class="glass-panel p-4"><h3 class="fw-bold text-success">{{ stats.sold }}</h3><p class="text-secondary m-0">Sold</p></div></div>
                            </div>
                            <div class="row g-4">
                                <div class="col-md-8">
                                    <div class="glass-panel p-4">
                                        <h5 class="mb-3">Weekly Traffic</h5>
                                        <canvas id="trafficChart" height="150"></canvas>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="glass-panel p-4">
                                        <h5 class="mb-3">Inventory Status</h5>
                                        <canvas id="statusChart" height="200"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="banners" class="admin-tab d-none">
                            <h2 class="fw-bold mb-4" style="color: var(--text-color);">Manage Home Banners</h2>
                            <div class="glass-panel p-4 mb-4">
                                <form action="/admin/banner/add" method="POST" enctype="multipart/form-data">
                                    <div class="row g-3">
                                        <div class="col-md-5"><input type="file" name="image" class="form-control bg-dark text-white border-secondary" required></div>
                                        <div class="col-md-3"><input type="text" name="title" class="form-control bg-dark text-white border-secondary" placeholder="Title (e.g. Sale!)"></div>
                                        <div class="col-md-3"><input type="text" name="subtitle" class="form-control bg-dark text-white border-secondary" placeholder="Subtitle"></div>
                                        <div class="col-md-1"><button class="btn btn-primary w-100"><i class="fas fa-plus"></i></button></div>
                                    </div>
                                </form>
                            </div>
                            <div class="glass-panel p-0 table-responsive">
                                <table class="table table-dark mb-0">
                                    <thead><tr><th>Image</th><th>Title</th><th>Subtitle</th><th>Action</th></tr></thead>
                                    <tbody>
                                        {% for b in banners %}
                                        <tr>
                                            <td><img src="{{ url_for('static', filename='uploads/' + b.image) }}" width="80" height="40" style="object-fit:cover; border-radius:5px;"></td>
                                            <td>{{ b.title }}</td>
                                            <td>{{ b.subtitle }}</td>
                                            <td><a href="/admin/banner/delete/{{ b.id }}" class="btn btn-sm btn-danger">Delete</a></td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div id="promos" class="admin-tab d-none">
                            <h2 class="fw-bold mb-4" style="color: var(--text-color);">Manage Promo Codes</h2>
                            <div class="glass-panel p-4 mb-4">
                                <form action="/admin/promo/create" method="POST" class="d-flex gap-2">
                                    <input type="text" name="code" class="form-control bg-dark text-white border-secondary" placeholder="Code (e.g. SALE5000)" required>
                                    <input type="number" name="amount" class="form-control bg-dark text-white border-secondary" placeholder="Amount (‚Çπ)" required>
                                    <button class="btn btn-success">Create</button>
                                </form>
                            </div>
                            <div class="glass-panel p-0 table-responsive">
                                <table class="table table-dark mb-0">
                                    <thead><tr><th>Code</th><th>Discount</th><th>Action</th></tr></thead>
                                    <tbody>
                                        {% for p in promos %}
                                        <tr>
                                            <td class="text-success fw-bold">{{ p.code }}</td>
                                            <td>‚Çπ{{ p.discount_amount }}</td>
                                            <td><a href="/admin/promo/delete/{{ p.id }}" class="btn btn-sm btn-danger">Delete</a></td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div id="inbox" class="admin-tab d-none">
                            <h2 class="fw-bold mb-4" style="color: var(--text-color);">Inbox</h2>
                            <div class="glass-panel overflow-hidden">
                                <div class="mail-list">
                                    {% for enq in enquiries %}
                                    <div class="mail-item {{ 'unread' if not enq.is_read else 'read' }}" onclick="openEnquiry({{ enq.id }}, '{{ enq.name }}', '{{ enq.phone }}', '{{ enq.message }}', '{{ enq.car.name }}')">
                                        <div class="text-center"><i class="far fa-{{ 'envelope' if not enq.is_read else 'envelope-open' }}"></i></div>
                                        <div>{{ enq.name }}</div>
                                        <div class="text-truncate text-secondary">{{ enq.message[:50] }}...</div>
                                        <div class="small text-end text-muted">{{ enq.date.strftime('%d %b') }}</div>
                                    </div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                        <div id="inventory" class="admin-tab d-none">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h2 class="fw-bold" style="color: var(--text-color);">Inventory</h2>
                                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addCarModal"><i class="fas fa-plus me-2"></i> Add</button>
                            </div>
                            <div class="glass-panel p-0 overflow-auto table-responsive">
                                <table class="table table-dark table-hover mb-0 align-middle text-nowrap">
                                    <thead class="bg-dark"><tr><th class="p-3">Car</th><th>Price</th><th>Status</th><th>Actions</th></tr></thead>
                                    <tbody>
                                        {% for car in cars %}
                                        <tr>
                                            <td class="p-3">
                                                <div class="d-flex align-items-center gap-3">
                                                    <img src="{{ url_for('static', filename='uploads/' + car.img_list[0]) }}" width="50" height="40" class="rounded">
                                                    <div><strong>{{ car.name }}</strong><br><small class="text-muted">{{ car.brand }}</small></div>
                                                </div>
                                            </td>
                                            <td>‚Çπ{{ "{:,}".format(car.price) }}</td>
                                            <td><span class="badge bg-secondary">{{ car.status }}</span></td>
                                            <td>
                                                <button class="btn btn-sm btn-outline-info" onclick="openEditModal('{{ car.id }}', '{{ car.name }}', '{{ car.price }}', '{{ car.status }}')"><i class="fas fa-edit"></i></button>
                                                <a href="/admin/delete/{{ car.id }}" class="btn btn-sm btn-outline-danger" onclick="return confirm('Delete?')"><i class="fas fa-trash"></i></a>
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal fade" id="addCarModal" tabindex="-1">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content glass-panel border-0 text-white">
                        <div class="modal-header"><h5 class="modal-title">Add Vehicle</h5><button class="btn-close btn-close-white" data-bs-dismiss="modal"></button></div>
                        <div class="modal-body">
                            <form action="/admin/add" method="POST" enctype="multipart/form-data">
                                <div class="row g-3">
                                    <div class="col-12"><input type="text" name="name" class="form-control bg-dark text-white border-secondary" placeholder="Car Name" required></div>
                                    <div class="col-md-6"><input type="text" list="brandList" name="brand" class="form-control bg-dark text-white border-secondary" placeholder="Brand" required></div>
                                    <datalist id="brandList"><option value="Maruti Suzuki"><option value="Hyundai"><option value="Tata"><option value="Mahindra"><option value="Toyota"><option value="Honda"></datalist>
                                    <div class="col-md-6"><input type="text" list="catList" name="category" class="form-control bg-dark text-white border-secondary" placeholder="Category" required></div>
                                    <datalist id="catList"><option value="SUV"><option value="Sedan"><option value="Hatchback"></datalist>
                                    <div class="col-6"><input type="number" name="price" class="form-control bg-dark text-white border-secondary" placeholder="Price"></div>
                                    <div class="col-6"><input type="number" name="year" class="form-control bg-dark text-white border-secondary" placeholder="Year"></div>
                                    <div class="col-6"><select name="fuel" class="form-select bg-dark text-white border-secondary"><option>Petrol</option><option>Diesel</option><option>CNG</option></select></div>
                                    <div class="col-6"><select name="transmission" class="form-select bg-dark text-white border-secondary"><option>Manual</option><option>Automatic</option></select></div>
                                    <div class="col-12"><input type="number" name="km_driven" class="form-control bg-dark text-white border-secondary" placeholder="KM Driven"></div>
                                    <div class="col-12"><textarea name="description" class="form-control bg-dark text-white border-secondary" placeholder="Description"></textarea></div>
                                    <div class="col-12"><input type="file" name="images" class="form-control bg-dark text-white border-secondary" multiple></div>
                                    <div class="col-12 mt-3"><button class="btn btn-primary w-100 fw-bold">Add to Inventory</button></div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal fade" id="editCarModal" tabindex="-1">
                <div class="modal-dialog">
                    <div class="modal-content glass-panel border-0 text-white">
                        <div class="modal-header"><h5 class="modal-title">Edit Vehicle</h5><button class="btn-close btn-close-white" data-bs-dismiss="modal"></button></div>
                        <div class="modal-body">
                            <form id="editCarForm" method="POST">
                                <div class="mb-3"><label class="small text-muted">Car Name</label><input type="text" name="name" id="editName" class="form-control bg-dark text-white border-secondary" required></div>
                                <div class="mb-3"><label class="small text-muted">Price</label><input type="number" name="price" id="editPrice" class="form-control bg-dark text-white border-secondary" required></div>
                                <div class="mb-3"><label class="small text-muted">Status</label><select name="status" id="editStatus" class="form-select bg-dark text-white border-secondary"><option value="Available">Available</option><option value="Sold">Sold</option><option value="Pending">Pending</option></select></div>
                                <button class="btn btn-success w-100 fw-bold">Update Vehicle</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal fade" id="readMailModal" tabindex="-1">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content glass-panel border-0 text-white">
                        <div class="modal-header border-bottom border-secondary"><h5 class="modal-title" id="mailSender">Name</h5><button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button></div>
                        <div class="modal-body">
                            <p class="text-info small mb-3" id="mailCar">Car Info</p>
                            <div class="p-3 bg-dark rounded mb-3 text-light" id="mailMessage">Message content...</div>
                            <div class="d-flex gap-2">
                                <a id="btnCall" href="#" class="btn btn-success btn-sm"><i class="fas fa-phone me-2"></i> Call</a>
                                <a id="btnMarkRead" href="#" class="btn btn-primary btn-sm">Mark as Read</a>
                                <a id="btnDeleteEnq" href="#" class="btn btn-danger btn-sm ms-auto"><i class="fas fa-trash"></i></a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <script>
                function showTab(tabId) {
                    document.querySelectorAll('.admin-tab').forEach(el => el.classList.add('d-none'));
                    document.getElementById(tabId).classList.remove('d-none');
                    document.querySelectorAll('.nav-link-admin').forEach(el => el.classList.remove('active'));
                    event.target.classList.add('active');
                }
                function openEnquiry(id, name, phone, msg, car) {
                    document.getElementById('mailSender').innerText = name + " (" + phone + ")";
                    document.getElementById('mailCar').innerText = "Regarding: " + car;
                    document.getElementById('mailMessage').innerText = msg;
                    document.getElementById('btnCall').href = "tel:" + phone;
                    document.getElementById('btnMarkRead').href = "/admin/enquiry/read/" + id;
                    document.getElementById('btnDeleteEnq').href = "/admin/enquiry/delete/" + id;
                    new bootstrap.Modal(document.getElementById('readMailModal')).show();
                }
                function openEditModal(id, name, price, status) {
                    document.getElementById('editCarForm').action = "/admin/edit/" + id;
                    document.getElementById('editName').value = name;
                    document.getElementById('editPrice').value = price;
                    document.getElementById('editStatus').value = status;
                    new bootstrap.Modal(document.getElementById('editCarModal')).show();
                }
                

                // Render Charts (Only if on admin page elements exist)
                {% if page == 'admin' %}
                const ctx1 = document.getElementById('trafficChart');
                if(ctx1) {
                    new Chart(ctx1, {
                        type: 'line',
                        data: {
                            labels: {{ graph_labels | tojson }},
                            datasets: [{ label: 'Enquiries', data: {{ graph_data | tojson }}, borderColor: '#00f2ea', tension: 0.4, fill: true, backgroundColor: 'rgba(0, 242, 234, 0.1)' }]
                        },
                        options: { scales: { y: { beginAtZero: true, grid: { color: 'rgba(255,255,255,0.1)' } }, x: { grid: { display: false } } }, plugins: { legend: { display: false } } }
                    });
                }
                const ctx2 = document.getElementById('statusChart');
                if(ctx2) {
                    new Chart(ctx2, {
                        type: 'doughnut',
                        data: {
                            labels: Object.keys({{ status_data | tojson }}),
                            datasets: [{ data: Object.values({{ status_data | tojson }}), backgroundColor: ['#28a745', '#ffc107', '#dc3545'], borderWidth: 0 }]
                        },
                        options: { cutout: '70%', plugins: { legend: { position: 'bottom', labels: { color: 'white' } } } }
                    });
                }
                {% endif %}
            </script>
        {% endif %}

        {% if car %}
        <div class="modal fade" id="enquiryModal" tabindex="-1">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content glass-panel border-0 text-white">
                    <div class="modal-header"><h5 class="modal-title">Contact Us</h5><button class="btn-close btn-close-white" data-bs-dismiss="modal"></button></div>
                    <div class="modal-body">
                        <form action="/enquire" method="POST">
                            <input type="hidden" name="car_id" value="{{ car.id }}">
                            <input type="text" name="name" class="form-control bg-dark text-white border-secondary mb-2" placeholder="Your Name" required>
                            <input type="text" name="phone" class="form-control bg-dark text-white border-secondary mb-2" placeholder="Phone Number" required>
                            <textarea name="message" class="form-control bg-dark text-white border-secondary mb-3" rows="3">I am interested in the {{ car.name }}...</textarea>
                            <button class="btn btn-primary w-100 fw-bold">Send Message</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
        
        {% if page == 'login' or page == 'signup' %}
            <div class="d-flex justify-content-center align-items-center" style="min-height: 60vh;">
                <div class="glass-panel p-5 text-center" style="max-width: 400px; width: 100%;">
                    <h2 class="mb-4 fw-bold" style="color: var(--text-color);">{{ 'Login' if page == 'login' else 'Join Us' }}</h2>
                    <form method="POST">
                        {% if page == 'signup' %}<input type="text" name="name" class="form-control bg-dark text-white border-secondary mb-3" placeholder="Full Name" required>{% endif %}
                        <input type="email" name="email" class="form-control bg-dark text-white border-secondary mb-3" placeholder="Email" required>
                        <input type="password" name="password" class="form-control bg-dark text-white border-secondary mb-3" placeholder="Password" required>
                        <button class="btn btn-primary w-100 fw-bold">{{ 'Enter System' if page == 'login' else 'Create Account' }}</button>
                    </form>
                    <div class="mt-4"><a href="/{{ 'signup' if page == 'login' else 'login' }}" class="text-secondary small text-decoration-none">Switch Mode</a></div>
                </div>
            </div>
        {% endif %}

    </div>

    <footer>
        <div class="container">
            <div class="row">
                <div class="col-md-4 mb-4">
                    <h5 class="text-primary">BABA CAR BAZAR</h5>
                    <p class="small">India's most trusted certified used car dealership. We provide quality checks, warranty, and the best prices guaranteed.</p>
                    <div class="d-flex gap-3 mt-3">
                        <a href="https://www.instagram.com/baba_car_bazaar?igsh=MXdpc2hmZjN1bm84bA=="><i class="fab fa-instagram fa-lg"></i></a>
                        
                        <a href="https://youtube.com/@babacarbazar300"><i class="fab fa-youtube fa-lg"></i></a>
                    </div>
                </div>
                <div class="col-md-2 mb-4">
                    <h5>Quick Links</h5>
                    <a href="/">Home</a>
                    <a href="/inventory">Inventory</a>
                    <a href="/sell-car">Sell Car</a>
                    <a href="/about">About Us</a>
                </div>
                <div class="col-md-3 mb-4">
                    <h5>Services</h5>
                    <p>Car Financing</p>
                
                    <p>Car Servicing</p>
                    <p>Accessories</p>
                </div>
                <div class="col-md-3 mb-4">
                    <h5>Contact Us</h5>
                    <a href="https://maps.app.goo.gl/2hyMoeFEHd9syQR4A" class="small mb-1"><i class="fas fa-map-marker-alt me-2"></i>Rama Devi, The Chappan Bhog, Near Kamla Guest House,BABA CAR BAZAR,Shyam Nagar Kanpur</p></a>
                    <p class="small mb-1"><i class="fas fa-phone me-2"></i> +91 98890 94583</p>
                    <p class="small mb-1"><i class="fas fa-phone me-2"></i> +91 95694 92242</p>
                    <p class="small mb-1"><i class="fas fa-phone me-2"></i> +91 82996 38480</p>
                    <br>
                    <p class="small mb-1"><i class="fas fa-envelope me-2"></i> 
                        babacarbazar7@gmail.com</p>
                </div>
    </div> 
    <div class="text-center pt-3 border-top border-secondary mt-3">
            <p class="small mb-1">¬© 2026 Baba Car Bazar. All Rights Reserved.</p>
            <a href="https://ashishkumar9589411421-svg.github.io/portfolio_v27-11-25/" class="small fw-bold text-light mb-3">Website Developed BY ASHISH KUMAR</p>
            
            <div class="d-flex justify-content-center gap-3">
            <a href="https://www.instagram.com/a_s__yadav_?igsh=MTM3MmlqcDZ4Zml0Mg==" class="text-secondary hover-primary"><i class="fab fa-instagram fa-lg"></i></a>
        <div class="text-center pt-3 border-top border-secondary mt-3">    
        </div>
        </div>

    </div> </footer>
        
        
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script>
        AOS.init({duration: 800, once: true});
        function toggleTheme() {
            const html = document.documentElement;
            if (html.getAttribute('data-bs-theme') === 'dark') {
                html.setAttribute('data-bs-theme', 'light');
            } else {
                html.setAttribute('data-bs-theme', 'dark');
            }
        }
    </script>
</body>
</html>
